# 系统时间戳更新频率建议

## 专业系统的更新频率实践

### 1. ERP 系统常见更新频率

根据业务需求和系统类型，专业 ERP 系统的更新时间戳频率通常如下：

#### **业务日期（Business Date）**
- **更新频率：每天 1 次**
- **更新时间：每天 00:00（业务时区）**
- **用途：用于业务日期判断、报表生成等**
- **示例系统：SAP、Oracle ERP、Microsoft Dynamics**

#### **系统时间戳（System Timestamp）**
- **高频系统（实时业务）：每 1-5 分钟**
  - 适用于：实时库存管理、订单处理、支付系统
  - 示例：电商平台、实时物流系统
  
- **中频系统（业务系统）：每 30 分钟 - 1 小时**
  - 适用于：大多数 ERP 系统、库存预测、报表生成
  - 示例：SAP、Oracle ERP、Microsoft Dynamics
  - **推荐：30 分钟**（平衡准确性和系统负载）
  
- **低频系统（报表系统）：每天 1-4 次**
  - 适用于：数据分析、报表系统、BI 系统
  - 示例：数据仓库、报表平台

### 2. 推荐配置（针对你的系统）

基于你的业务场景（库存预测、订单管理、运输管理），**推荐更新频率：每 30 分钟**

**理由：**
1. **业务需求**：库存预测需要相对准确的时间戳，但不需要秒级精度
2. **系统负载**：30 分钟更新一次，不会对数据库造成太大压力
3. **准确性**：对于 ERP 业务场景，30 分钟的误差是可以接受的
4. **行业标准**：大多数 ERP 系统采用 30 分钟到 1 小时的更新频率

### 3. 不同场景的更新频率建议

| 场景 | 推荐频率 | 说明 |
|------|---------|------|
| 库存预测报表 | 30 分钟 | 平衡准确性和系统负载 |
| 订单处理 | 5-15 分钟 | 需要相对实时的时间戳 |
| 报表生成 | 1 小时 | 报表通常不需要实时时间 |
| 数据分析 | 1-4 小时 | 数据分析对时间精度要求较低 |
| 实时业务 | 1-5 分钟 | 需要接近实时的时间戳 |

### 4. 定时任务配置示例

#### 4.1 使用 pg_cron（数据库定时任务）

```sql
-- 每 30 分钟更新一次系统时间戳
SELECT cron.schedule(
  'update-system-timestamp-30min',
  '*/30 * * * *',  -- 每 30 分钟
  $$SELECT public.update_system_timestamp('30 minutes'::INTERVAL)$$
);
```

#### 4.2 使用 Vercel Cron Jobs（云服务定时任务）

在 `vercel.json` 中配置：

```json
{
  "crons": [
    {
      "path": "/api/cron/update-system-timestamp?interval_minutes=30",
      "schedule": "*/30 * * * *"
    }
  ]
}
```

#### 4.3 使用 Node.js cron（应用层定时任务）

```typescript
import cron from 'node-cron'
import { updateSystemTimestamp } from '@/lib/services/system-timestamp-service'

// 每 30 分钟执行一次
cron.schedule('*/30 * * * *', async () => {
  await updateSystemTimestamp(30)
})
```

### 5. 性能考虑

#### 5.1 更新频率 vs 系统负载

- **每 1 分钟更新**：数据库写入压力较大，不推荐
- **每 30 分钟更新**：平衡准确性和系统负载，**推荐**
- **每 1 小时更新**：系统负载最小，但时间精度较低

#### 5.2 数据库影响

- 每次更新只涉及 1 条记录的 UPDATE 操作
- 对数据库性能影响极小
- 可以安全地设置为 30 分钟更新一次

### 6. 最佳实践建议

1. **初始设置**：首次部署时，手动设置系统时间戳为当前时间
2. **定时更新**：使用定时任务每 30 分钟自动更新
3. **监控告警**：监控时间戳更新是否正常执行
4. **手动调整**：必要时可以手动调整时间戳（如系统维护后）

### 7. 总结

**推荐配置：每 30 分钟更新一次系统时间戳**

- ✅ 满足业务需求（库存预测、订单管理等）
- ✅ 系统负载合理
- ✅ 符合行业标准
- ✅ 易于维护和管理

