# Netlify 配置文件

[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "20"
  NPM_VERSION = "10"
  PRISMA_CLI_BINARY_TARGETS = "rhel-openssl-3.0.x"
  NEXT_TELEMETRY_DISABLED = "1"
  # 生产优化
  NODE_ENV = "production"
  # 减少构建日志
  CI = "true"

# Netlify Next.js 插件配置
# 这个插件会自动处理 Next.js 的构建和部署，包括函数打包和依赖管理
# 注意：插件需要在 Netlify 平台上安装，不需要在 package.json 中
# 插件会自动处理：
# - Next.js 路由和 API 路由
# - 中间件
# - 静态文件
# - 重定向规则
[[plugins]]
  package = "@netlify/plugin-nextjs"

# 函数配置
[functions]
  node_bundler = "esbuild"
  # 库存预测等复杂计算在 Netlify 控制台设置超时为 26 秒

# 重定向规则
# Next.js 插件会自动处理所有路由重定向，不需要手动配置
# 如果需要自定义重定向，可以在这里添加

# 环境变量配置说明
# 以下环境变量需要在 Netlify 控制台的 "Site settings" → "Environment variables" 中配置：
# 
# 必需的环境变量：
# - DATABASE_URL: Neon DB 连接字符串
# - NEXTAUTH_SECRET: NextAuth.js 密钥（用于加密 session）
# - NEXTAUTH_URL: 生产环境 URL（例如：https://your-site.netlify.app）
# 
# 可选的环境变量：
# - NODE_ENV: 设置为 "production"
# - PRISMA_CLI_BINARY_TARGETS: 如果与上面的配置不同，可以在这里覆盖
