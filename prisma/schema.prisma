generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["analytics", "oms", "public", "tms", "wms"]
}

model delivery_appointments {
  appointment_id                                                BigInt                     @id @default(autoincrement())
  order_id                                                      BigInt?
  location_id                                                   BigInt?
  origin_location_id                                            BigInt?
  appointment_type                                              String?                    @db.VarChar(50)
  requested_start                                               DateTime?                  @db.Timestamptz(6)
  requested_end                                                 DateTime?                  @db.Timestamptz(6)
  confirmed_start                                               DateTime?                  @db.Timestamptz(6)
  confirmed_end                                                 DateTime?                  @db.Timestamptz(6)
  status                                                        String?                    @default("requested") @db.VarChar(50)
  reference_number                                              String?                    @db.VarChar(100)
  delivery_method                                               String?                    @db.VarChar(50)
  appointment_account                                           String?                    @db.VarChar(100)
  rejected                                                      Boolean?                   @default(false)
  total_pallets                                                 Int                        @default(0) // 预约总板数（累加所有预约明细的estimated_pallets）
  po                                                            String?                    @db.VarChar(1000)
  notes                                                         String?
  created_at                                                    DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at                                                    DateTime?                  @default(now()) @db.Timestamptz(6)
  created_by                                                    BigInt?
  updated_by                                                    BigInt?
  users_delivery_appointments_created_byTousers                 users?                     @relation("delivery_appointments_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations                                                     locations?                 @relation("delivery_appointments_location_idTolocations", fields: [location_id], references: [location_id], onDelete: NoAction, onUpdate: NoAction)
  locations_delivery_appointments_origin_location_idTolocations locations?                 @relation("delivery_appointments_origin_location_idTolocations", fields: [origin_location_id], references: [location_id], onDelete: NoAction, onUpdate: NoAction)
  orders                                                        orders?                    @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  users_delivery_appointments_updated_byTousers                 users?                     @relation("delivery_appointments_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  appointment_detail_lines                                      appointment_detail_lines[]
  outbound_shipments                                            outbound_shipments?
  delivery_management                                           delivery_management?

  @@index([confirmed_start], map: "idx_delivery_appointments_confirmed_start")
  @@index([rejected], map: "idx_delivery_appointments_rejected")
  @@schema("oms")
}

model appointment_detail_lines {
  id                                               BigInt                @id @default(autoincrement())
  appointment_id                                   BigInt // 关联到 delivery_appointments.appointment_id
  order_detail_id                                  BigInt // 关联到 order_detail.id
  estimated_pallets                                Int // 这个预约送了多少板
  total_pallets_at_time                            Int? // 总板数快照（创建/更新时的总板数，用于审计和历史追溯）
  // po 字段已移除，PO 应该从 order_detail.po 读取
  created_at                                       DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime?             @default(now()) @db.Timestamptz(6)
  created_by                                       BigInt?
  updated_by                                       BigInt?
  delivery_appointments                            delivery_appointments @relation(fields: [appointment_id], references: [appointment_id], onDelete: Cascade, onUpdate: NoAction)
  order_detail                                     order_detail          @relation(fields: [order_detail_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_appointment_detail_lines_created_byTousers users?                @relation("appointment_detail_lines_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_appointment_detail_lines_updated_byTousers users?                @relation("appointment_detail_lines_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([appointment_id, order_detail_id], map: "appointment_detail_lines_unique")
  @@index([appointment_id], map: "idx_appointment_detail_lines_appointment_id")
  @@index([order_detail_id], map: "idx_appointment_detail_lines_order_detail_id")
  @@schema("oms")
}

model order_allocations {
  allocation_id                             BigInt    @id @default(autoincrement())
  order_id                                  BigInt
  allocation_entity_type                    String    @db.VarChar(50)
  notes                                     String?
  created_at                                DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                DateTime? @default(now()) @db.Timestamptz(6)
  created_by                                BigInt?
  updated_by                                BigInt?
  users_order_allocations_created_byTousers users?    @relation("order_allocations_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                                    orders    @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  users_order_allocations_updated_byTousers users?    @relation("order_allocations_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("oms")
}

model order_requirements {
  requirement_id                             BigInt    @id @default(autoincrement())
  order_id                                   BigInt
  requirement_type                           String    @db.VarChar(50)
  requirement_value                          String?
  notes                                      String?
  created_at                                 DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                 DateTime? @default(now()) @db.Timestamptz(6)
  created_by                                 BigInt?
  updated_by                                 BigInt?
  users_order_requirements_created_byTousers users?    @relation("order_requirements_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                                     orders    @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  users_order_requirements_updated_byTousers users?    @relation("order_requirements_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("oms")
}

model calendar_dim {
  calendar_date DateTime @id @db.Date
  year          Int
  quarter       Int
  month         Int
  month_name    String?  @db.VarChar(20)
  week_of_year  Int?
  day_of_week   Int?
  day_name      String?  @db.VarChar(20)
  is_weekend    Boolean?
  is_holiday    Boolean? @default(false)

  @@schema("public")
}

model system_config {
  config_key   String   @id @db.VarChar(100)
  config_value String   @db.VarChar(500)
  description  String?
  updated_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_by   BigInt?

  @@schema("public")
}

model carrier_service_levels {
  service_level_id                               BigInt    @id @default(autoincrement())
  carrier_id                                     BigInt?
  service_level_code                             String    @db.VarChar(50)
  description                                    String?   @db.VarChar(200)
  transit_time_days                              Int?
  on_time_target                                 Decimal?  @db.Decimal(5, 2)
  effective_from                                 DateTime? @db.Date
  effective_to                                   DateTime? @db.Date
  created_at                                     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                     DateTime? @default(now()) @db.Timestamptz(6)
  created_by                                     BigInt?
  updated_by                                     BigInt?
  carriers                                       carriers? @relation(fields: [carrier_id], references: [carrier_id], onDelete: NoAction, onUpdate: NoAction)
  users_carrier_service_levels_created_byTousers users?    @relation("carrier_service_levels_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_carrier_service_levels_updated_byTousers users?    @relation("carrier_service_levels_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([carrier_id, service_level_code], map: "carrier_service_levels_carrier_code_uniq")
  @@schema("public")
}

model carriers {
  carrier_id                       BigInt                   @id @default(autoincrement())
  carrier_code                     String?                  @unique @db.VarChar(50)
  name                             String                   @db.VarChar(200)
  carrier_type                     String?                  @db.VarChar(50)
  created_at                       DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at                       DateTime?                @default(now()) @db.Timestamptz(6)
  contact_id                       BigInt?
  created_by                       BigInt?
  updated_by                       BigInt?
  carrier_service_levels           carrier_service_levels[]
  contact_roles                    contact_roles?           @relation(fields: [contact_id], references: [contact_id], onDelete: NoAction, onUpdate: NoAction)
  users_carriers_created_byTousers users?                   @relation("carriers_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_carriers_updated_byTousers users?                   @relation("carriers_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  drivers                          drivers[]
  orders                           orders[]
  vehicles                         vehicles[]
  freight_bills                    freight_bills[]

  @@schema("public")
}

model contact_roles {
  contact_id                            BigInt      @id @default(autoincrement())
  related_entity_type                   String      @db.VarChar(50)
  related_entity_id                     BigInt
  role                                  String      @db.VarChar(50)
  name                                  String      @db.VarChar(100)
  phone                                 String?     @db.VarChar(50)
  email                                 String?     @db.VarChar(200)
  notes                                 String?
  created_at                            DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at                            DateTime?   @default(now()) @db.Timestamptz(6)
  address_line1                         String?     @db.VarChar(200)
  address_line2                         String?     @db.VarChar(200)
  city                                  String?     @db.VarChar(100)
  state                                 String?     @db.VarChar(100)
  postal_code                           String?     @db.VarChar(20)
  country                               String?     @db.VarChar(100)
  is_primary                            Boolean?    @default(false)
  created_by                            BigInt?
  updated_by                            BigInt?
  carriers                              carriers[]
  users_contact_roles_created_byTousers users?      @relation("contact_roles_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_contact_roles_updated_byTousers users?      @relation("contact_roles_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customers                             customers[]
  drivers                               drivers[]

  @@schema("public")
}

model customers {
  id                                BigInt         @id @default(autoincrement())
  code                              String         @unique @db.VarChar(50)
  name                              String         @db.VarChar(200)
  company_name                      String?        @db.VarChar(200)
  credit_limit                      Decimal?       @default(0) @db.Decimal(12, 2)
  status                            String?        @default("active") @db.VarChar(20)
  created_at                        DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at                        DateTime?      @default(now()) @db.Timestamptz(6)
  contact_id                        BigInt?
  created_by                        BigInt?
  updated_by                        BigInt?
  contact_roles                     contact_roles? @relation(fields: [contact_id], references: [contact_id], onDelete: NoAction, onUpdate: NoAction)
  users_customers_created_byTousers users?         @relation("customers_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_customers_updated_byTousers users?         @relation("customers_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                            orders[]

  @@schema("public")
}

model delivery_status_codes {
  status_code                                   String       @id @db.VarChar(50)
  description                                   String?      @db.VarChar(200)
  is_active                                     Boolean?     @default(true)
  created_at                                    DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at                                    DateTime?    @default(now()) @db.Timestamptz(6)
  created_by                                    BigInt?
  updated_by                                    BigInt?
  users_delivery_status_codes_created_byTousers users?       @relation("delivery_status_codes_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_delivery_status_codes_updated_byTousers users?       @relation("delivery_status_codes_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  events_log                                    events_log[]

  @@schema("public")
}

model departments {
  id                                     BigInt        @id @default(autoincrement())
  name                                   String        @db.VarChar(100)
  code                                   String        @unique @db.VarChar(20)
  parent_id                              BigInt?
  manager_id                             BigInt?
  description                            String?
  created_at                             DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at                             DateTime?     @default(now()) @db.Timestamptz(6)
  created_by                             BigInt?
  updated_by                             BigInt?
  users_departments_created_byTousers    users?        @relation("departments_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  departments                            departments?  @relation("departmentsTodepartments", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_departments                      departments[] @relation("departmentsTodepartments")
  users_departments_updated_byTousers    users?        @relation("departments_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  trailers                               trailers[]
  users_users_department_idTodepartments users[]       @relation("users_department_idTodepartments")

  @@schema("public")
}

model document_links {
  document_id                                                                  BigInt               @id @default(autoincrement())
  entity_type                                                                  String               @db.VarChar(50)
  entity_id                                                                    BigInt
  document_type                                                                String               @db.VarChar(50)
  document_name                                                                String?              @db.VarChar(200)
  document_url                                                                 String
  metadata                                                                     Json?
  uploaded_at                                                                  DateTime?            @default(now()) @db.Timestamptz(6)
  uploaded_by                                                                  BigInt?
  created_at                                                                   DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at                                                                   DateTime?            @default(now()) @db.Timestamptz(6)
  created_by                                                                   BigInt?
  updated_by                                                                   BigInt?
  users_document_links_created_byTousers                                       users?               @relation("document_links_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_document_links_updated_byTousers                                       users?               @relation("document_links_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_document_links_uploaded_byTousers                                      users?               @relation("document_links_uploaded_byTousers", fields: [uploaded_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  outbound_shipments_outbound_shipments_bol_document_idTodocument_links        outbound_shipments[] @relation("outbound_shipments_bol_document_idTodocument_links")
  outbound_shipments_outbound_shipments_load_sheet_document_idTodocument_links outbound_shipments[] @relation("outbound_shipments_load_sheet_document_idTodocument_links")

  @@schema("public")
}

model drivers {
  driver_id                       BigInt                @id @default(autoincrement())
  carrier_id                      BigInt?
  driver_code                     String?               @unique @db.VarChar(50)
  license_number                  String?               @db.VarChar(100)
  license_plate                   String?               @db.VarChar(10)
  license_expiration              DateTime?             @db.Date
  notes                           String?
  status                          String?               @default("active") @db.VarChar(50)
  created_at                      DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at                      DateTime?             @default(now()) @db.Timestamptz(6)
  contact_id                      BigInt?
  created_by                      BigInt?
  updated_by                      BigInt?
  carriers                        carriers?             @relation(fields: [carrier_id], references: [carrier_id], onDelete: NoAction, onUpdate: NoAction)
  contact_roles                   contact_roles?        @relation(fields: [contact_id], references: [contact_id], onDelete: NoAction, onUpdate: NoAction)
  users_drivers_created_byTousers users?                @relation("drivers_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_drivers_updated_byTousers users?                @relation("drivers_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  delivery_management             delivery_management[]
  pickup_management               pickup_management[]

  @@schema("public")
}

model events_log {
  event_id                           BigInt                 @id @default(autoincrement())
  entity_type                        String                 @db.VarChar(50)
  entity_id                          BigInt
  event_type                         String                 @db.VarChar(100)
  event_time                         DateTime               @db.Timestamptz(6)
  location_id                        BigInt?
  status_code                        String?                @db.VarChar(50)
  details                            Json?
  created_at                         DateTime?              @default(now()) @db.Timestamptz(6)
  created_by                         BigInt?
  updated_at                         DateTime?              @default(now()) @db.Timestamptz(6)
  updated_by                         BigInt?
  users_events_log_created_byTousers users?                 @relation("events_log_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations                          locations?             @relation(fields: [location_id], references: [location_id], onDelete: NoAction, onUpdate: NoAction)
  delivery_status_codes              delivery_status_codes? @relation(fields: [status_code], references: [status_code], onDelete: NoAction, onUpdate: NoAction)
  users_events_log_updated_byTousers users?                 @relation("events_log_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([entity_type, entity_id], map: "idx_events_log_entity")
  @@index([entity_type, entity_id], map: "idx_shipment_events_entity")
  @@index([event_time], map: "idx_shipment_events_time")
  @@schema("public")
}

model locations {
  location_id                                                               BigInt                  @id @default(autoincrement())
  location_code                                                             String?                 @unique @db.VarChar(50)
  name                                                                      String                  @db.VarChar(200)
  location_type                                                             String                  @db.VarChar(50)
  address_line1                                                             String?                 @db.VarChar(200)
  address_line2                                                             String?                 @db.VarChar(200)
  city                                                                      String?                 @db.VarChar(100)
  state                                                                     String?                 @db.VarChar(100)
  postal_code                                                               String?                 @db.VarChar(20)
  country                                                                   String?                 @db.VarChar(100)
  timezone                                                                  String?                 @db.VarChar(100)
  latitude                                                                  Decimal?                @db.Decimal(10, 6)
  longitude                                                                 Decimal?                @db.Decimal(10, 6)
  notes                                                                     String?
  created_at                                                                DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at                                                                DateTime?               @default(now()) @db.Timestamptz(6)
  created_by                                                                BigInt?
  updated_by                                                                BigInt?
  delivery_appointments                                                     delivery_appointments[] @relation("delivery_appointments_location_idTolocations")
  delivery_appointments_delivery_appointments_origin_location_idTolocations delivery_appointments[] @relation("delivery_appointments_origin_location_idTolocations")
  events_log                                                                events_log[]
  users_locations_created_byTousers                                         users?                  @relation("locations_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_locations_updated_byTousers                                         users?                  @relation("locations_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses                                                                warehouses[]
  orders_orders_port_location_idTolocations                                 orders[]                @relation("orders_port_location_idTolocations")
  orders_orders_delivery_location_idTolocations                             orders[]                @relation("orders_delivery_location_idTolocations")

  @@schema("public")
}

model order_detail {
  id                                                          BigInt                     @id @default(autoincrement())
  order_id                                                    BigInt?
  detail_id                                                   BigInt?
  quantity                                                    Int
  created_at                                                  DateTime?                  @default(now()) @db.Timestamptz(6)
  volume                                                      Decimal?                   @db.Decimal
  estimated_pallets                                           Int?
  remaining_pallets                                           Int? // 未约板数（预计板数 - 所有预约的预计板数之和，仅未入库时使用）
  created_by                                                  BigInt?
  updated_at                                                  DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_by                                                  BigInt?
  delivery_nature                                             String?                    @db.VarChar(50)
  volume_percentage                                           Decimal?                   @db.Decimal(5, 2)
  delivery_location                                           String?                    @db.VarChar(200)
  fba                                                         String?                    @db.VarChar(1000)
  notes                                                       String?
  po                                                          String?                    @db.VarChar(1000)
  users_order_detail_created_byTousers                        users?                     @relation("order_detail_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_detail_item_order_detail_detail_idToorder_detail_item order_detail_item?         @relation("order_detail_detail_idToorder_detail_item", fields: [detail_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                                                      orders?                    @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  users_order_detail_updated_byTousers                        users?                     @relation("order_detail_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_detail_item_order_detail_item_detail_idToorder_detail order_detail_item[]        @relation("order_detail_item_detail_idToorder_detail")
  inventory_lots                                              inventory_lots[]
  outbound_shipment_lines                                     outbound_shipment_lines[]
  appointment_detail_lines                                    appointment_detail_lines[]

  @@index([detail_id], map: "idx_order_detail_detail")
  @@index([order_id], map: "idx_order_detail_order")
  @@index([delivery_location], map: "idx_order_detail_delivery_location")
  @@index([delivery_nature], map: "idx_order_detail_delivery_nature")
  @@schema("public")
}

model order_detail_item {
  id                                                     BigInt         @id @default(autoincrement())
  detail_name                                            String         @unique(map: "order_detail_item_detail_code_key") @db.VarChar(50)
  sku                                                    String         @db.VarChar(200)
  description                                            String?
  stock_quantity                                         Int?           @default(0)
  status                                                 String?        @default("active") @db.VarChar(20)
  created_at                                             DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at                                             DateTime?      @default(now()) @db.Timestamptz(6)
  fba                                                    String?        @db.VarChar(100)
  created_by                                             BigInt?
  updated_by                                             BigInt?
  detail_id                                              BigInt?
  volume                                                 Decimal?       @db.Decimal
  order_detail_order_detail_detail_idToorder_detail_item order_detail[] @relation("order_detail_detail_idToorder_detail_item")
  users_order_detail_item_created_byTousers              users?         @relation("order_detail_item_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_detail_order_detail_item_detail_idToorder_detail order_detail?  @relation("order_detail_item_detail_idToorder_detail", fields: [detail_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_order_detail_item_updated_byTousers              users?         @relation("order_detail_item_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([detail_name], map: "idx_order_detail_item_detail_code")
  @@schema("public")
}

model orders {
  order_id                                         BigInt                    @id @default(autoincrement())
  order_number                                     String                    @unique @db.VarChar(50)
  customer_id                                      BigInt?
  user_id                                          BigInt?
  order_date                                       DateTime                  @db.Date
  status                                           String?                   @default("pending") @db.VarChar(20)
  total_amount                                     Decimal                   @db.Decimal(12, 2)
  discount_amount                                  Decimal?                  @default(0) @db.Decimal(12, 2)
  tax_amount                                       Decimal?                  @default(0) @db.Decimal(12, 2)
  final_amount                                     Decimal                   @db.Decimal(12, 2)
  notes                                            String?
  created_at                                       DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime?                 @default(now()) @db.Timestamptz(6)
  eta_date                                         DateTime?                 @db.Date
  lfd_date                                         DateTime?                 @db.Date
  pickup_date                                      DateTime?                 @db.Timestamptz(3)
  created_by                                       BigInt?
  updated_by                                       BigInt?
  ready_date                                       DateTime?                 @db.Date
  return_deadline                                  DateTime?                 @db.Date
  container_type                                   String?                   @db.VarChar(50)
  container_volume                                 Decimal?                  @default(0) @db.Decimal(12, 2)
  mbl_number                                       String?                   @db.VarChar(100)
  do_issued                                        Boolean?                  @default(false)
  warehouse_account                                String?                   @db.VarChar(100)
  port_location                                    String?                   @db.VarChar(200)
  port_location_id                                 BigInt?
  operation_mode                                   String?                   @db.VarChar(50)
  delivery_location                                String?                   @db.VarChar(200)
  delivery_location_id                             BigInt?
  carrier_id                                       BigInt?
  appointment_time                                 DateTime?                 @db.Timestamptz(6)
  delivery_appointments                            delivery_appointments[]
  order_allocations                                order_allocations[]
  order_requirements                               order_requirements[]
  order_detail                                     order_detail[]
  carriers                                         carriers?                 @relation(fields: [carrier_id], references: [carrier_id], onDelete: NoAction, onUpdate: NoAction, map: "orders_carrier_id_fk")
  users_orders_created_byTousers                   users?                    @relation("orders_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customers                                        customers?                @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_orders_updated_byTousers                   users?                    @relation("orders_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_orders_user_idTousers                      users?                    @relation("orders_user_idTousers", fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations_orders_port_location_idTolocations     locations?                @relation("orders_port_location_idTolocations", fields: [port_location_id], references: [location_id], onDelete: SetNull, onUpdate: Cascade)
  locations_orders_delivery_location_idTolocations locations?                @relation("orders_delivery_location_idTolocations", fields: [delivery_location_id], references: [location_id], onDelete: SetNull, onUpdate: Cascade)
  pickup_management                                pickup_management?
  inbound_receipt                                  inbound_receipt?
  inventory_lots                                   inventory_lots[]
  outbound_shipment_lines                          outbound_shipment_lines[]

  @@index([customer_id], map: "idx_order_customer")
  @@index([order_date], map: "idx_order_date")
  @@index([user_id], map: "idx_order_user")
  @@index([carrier_id], map: "idx_orders_carrier")
  @@index([container_type], map: "idx_orders_container_type")
  @@index([mbl_number], map: "idx_orders_mbl_number")
  @@index([port_location_id], map: "idx_orders_port_location_id")
  @@index([delivery_location_id], map: "idx_orders_delivery_location_id")
  @@schema("public")
}

model shift_dim {
  shift_id     BigInt      @id @default(autoincrement())
  warehouse_id BigInt?
  shift_code   String      @db.VarChar(50)
  description  String?     @db.VarChar(200)
  start_time   DateTime?   @db.Time(6)
  end_time     DateTime?   @db.Time(6)
  is_active    Boolean?    @default(true)
  warehouses   warehouses? @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

model trailers {
  trailer_id                       BigInt               @id @default(autoincrement())
  department_id                    BigInt?
  trailer_code                     String?              @unique @db.VarChar(50)
  trailer_type                     String?              @db.VarChar(50)
  length_feet                      Decimal?             @db.Decimal(5, 2)
  capacity_weight                  Decimal?             @db.Decimal(12, 2)
  capacity_volume                  Decimal?             @db.Decimal(12, 2)
  status                           String?              @default("available") @db.VarChar(50)
  notes                            String?
  created_at                       DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at                       DateTime?            @default(now()) @db.Timestamptz(6)
  created_by                       BigInt?
  updated_by                       BigInt?
  users_trailers_created_byTousers users?               @relation("trailers_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  departments                      departments?         @relation(fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_trailers_updated_byTousers users?               @relation("trailers_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  outbound_shipments               outbound_shipments[]

  @@schema("public")
}

model unload_methods {
  method_code                            String            @id @db.VarChar(50)
  description                            String?           @db.VarChar(200)
  is_active                              Boolean?          @default(true)
  created_at                             DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at                             DateTime?         @default(now()) @db.Timestamptz(6)
  created_by                             BigInt?
  updated_by                             BigInt?
  users_unload_methods_created_byTousers users?            @relation("unload_methods_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_unload_methods_updated_byTousers users?            @relation("unload_methods_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  inbound_receipt                        inbound_receipt[]

  @@schema("public")
}

model users {
  id                                                                  BigInt                     @id @default(autoincrement())
  username                                                            String                     @unique @db.VarChar(50)
  password_hash                                                       String                     @db.VarChar(255)
  full_name                                                           String?                    @db.VarChar(100)
  department_id                                                       BigInt?
  role                                                                String?                    @default("employee") @db.VarChar(50)
  status                                                              String?                    @default("active") @db.VarChar(20)
  phone                                                               String?                    @db.VarChar(20)
  avatar_url                                                          String?
  created_at                                                          DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at                                                          DateTime?                  @default(now()) @db.Timestamptz(6)
  created_by                                                          BigInt?
  updated_by                                                          BigInt?
  delivery_appointments_delivery_appointments_created_byTousers       delivery_appointments[]    @relation("delivery_appointments_created_byTousers")
  delivery_appointments_delivery_appointments_updated_byTousers       delivery_appointments[]    @relation("delivery_appointments_updated_byTousers")
  order_allocations_order_allocations_created_byTousers               order_allocations[]        @relation("order_allocations_created_byTousers")
  order_allocations_order_allocations_updated_byTousers               order_allocations[]        @relation("order_allocations_updated_byTousers")
  order_requirements_order_requirements_created_byTousers             order_requirements[]       @relation("order_requirements_created_byTousers")
  order_requirements_order_requirements_updated_byTousers             order_requirements[]       @relation("order_requirements_updated_byTousers")
  carrier_service_levels_carrier_service_levels_created_byTousers     carrier_service_levels[]   @relation("carrier_service_levels_created_byTousers")
  carrier_service_levels_carrier_service_levels_updated_byTousers     carrier_service_levels[]   @relation("carrier_service_levels_updated_byTousers")
  carriers_carriers_created_byTousers                                 carriers[]                 @relation("carriers_created_byTousers")
  carriers_carriers_updated_byTousers                                 carriers[]                 @relation("carriers_updated_byTousers")
  contact_roles_contact_roles_created_byTousers                       contact_roles[]            @relation("contact_roles_created_byTousers")
  contact_roles_contact_roles_updated_byTousers                       contact_roles[]            @relation("contact_roles_updated_byTousers")
  customers_customers_created_byTousers                               customers[]                @relation("customers_created_byTousers")
  customers_customers_updated_byTousers                               customers[]                @relation("customers_updated_byTousers")
  delivery_status_codes_delivery_status_codes_created_byTousers       delivery_status_codes[]    @relation("delivery_status_codes_created_byTousers")
  delivery_status_codes_delivery_status_codes_updated_byTousers       delivery_status_codes[]    @relation("delivery_status_codes_updated_byTousers")
  departments_departments_created_byTousers                           departments[]              @relation("departments_created_byTousers")
  departments_departments_updated_byTousers                           departments[]              @relation("departments_updated_byTousers")
  document_links_document_links_created_byTousers                     document_links[]           @relation("document_links_created_byTousers")
  document_links_document_links_updated_byTousers                     document_links[]           @relation("document_links_updated_byTousers")
  document_links_document_links_uploaded_byTousers                    document_links[]           @relation("document_links_uploaded_byTousers")
  drivers_drivers_created_byTousers                                   drivers[]                  @relation("drivers_created_byTousers")
  drivers_drivers_updated_byTousers                                   drivers[]                  @relation("drivers_updated_byTousers")
  events_log_events_log_created_byTousers                             events_log[]               @relation("events_log_created_byTousers")
  events_log_events_log_updated_byTousers                             events_log[]               @relation("events_log_updated_byTousers")
  locations_locations_created_byTousers                               locations[]                @relation("locations_created_byTousers")
  locations_locations_updated_byTousers                               locations[]                @relation("locations_updated_byTousers")
  order_detail_order_detail_created_byTousers                         order_detail[]             @relation("order_detail_created_byTousers")
  order_detail_order_detail_updated_byTousers                         order_detail[]             @relation("order_detail_updated_byTousers")
  order_detail_item_order_detail_item_created_byTousers               order_detail_item[]        @relation("order_detail_item_created_byTousers")
  order_detail_item_order_detail_item_updated_byTousers               order_detail_item[]        @relation("order_detail_item_updated_byTousers")
  orders_orders_created_byTousers                                     orders[]                   @relation("orders_created_byTousers")
  orders_orders_updated_byTousers                                     orders[]                   @relation("orders_updated_byTousers")
  orders_orders_user_idTousers                                        orders[]                   @relation("orders_user_idTousers")
  trailers_trailers_created_byTousers                                 trailers[]                 @relation("trailers_created_byTousers")
  trailers_trailers_updated_byTousers                                 trailers[]                 @relation("trailers_updated_byTousers")
  unload_methods_unload_methods_created_byTousers                     unload_methods[]           @relation("unload_methods_created_byTousers")
  unload_methods_unload_methods_updated_byTousers                     unload_methods[]           @relation("unload_methods_updated_byTousers")
  users_users_created_byTousers                                       users?                     @relation("users_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_users_users_created_byTousers                                 users[]                    @relation("users_created_byTousers")
  departments_users_department_idTodepartments                        departments?               @relation("users_department_idTodepartments", fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_users_updated_byTousers                                       users?                     @relation("users_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_users_users_updated_byTousers                                 users[]                    @relation("users_updated_byTousers")
  vehicles_vehicles_created_byTousers                                 vehicles[]                 @relation("vehicles_created_byTousers")
  vehicles_vehicles_updated_byTousers                                 vehicles[]                 @relation("vehicles_updated_byTousers")
  warehouses_warehouses_contact_user_idTousers                        warehouses[]               @relation("warehouses_contact_user_idTousers")
  pickup_management_pickup_management_created_byTousers               pickup_management[]        @relation("pickup_management_created_byTousers")
  pickup_management_pickup_management_updated_byTousers               pickup_management[]        @relation("pickup_management_updated_byTousers")
  delivery_management_delivery_management_created_byTousers           delivery_management[]      @relation("delivery_management_created_byTousers")
  delivery_management_delivery_management_updated_byTousers           delivery_management[]      @relation("delivery_management_updated_byTousers")
  warehouses_warehouses_created_byTousers                             warehouses[]               @relation("warehouses_created_byTousers")
  warehouses_warehouses_updated_byTousers                             warehouses[]               @relation("warehouses_updated_byTousers")
  freight_bills_freight_bills_created_byTousers                       freight_bills[]            @relation("freight_bills_created_byTousers")
  freight_bills_freight_bills_updated_byTousers                       freight_bills[]            @relation("freight_bills_updated_byTousers")
  inbound_receipt_inbound_receipt_created_byTousers                   inbound_receipt[]          @relation("inbound_receipt_created_byTousers")
  inbound_receipt_inbound_receipt_received_byTousers                  inbound_receipt[]          @relation("inbound_receipt_received_byTousers")
  inbound_receipt_inbound_receipt_updated_byTousers                   inbound_receipt[]          @relation("inbound_receipt_updated_byTousers")
  inventory_lots_inventory_lots_created_byTousers                     inventory_lots[]           @relation("inventory_lots_created_byTousers")
  inventory_lots_inventory_lots_updated_byTousers                     inventory_lots[]           @relation("inventory_lots_updated_byTousers")
  outbound_shipment_lines_outbound_shipment_lines_created_byTousers   outbound_shipment_lines[]  @relation("outbound_shipment_lines_created_byTousers")
  outbound_shipment_lines_outbound_shipment_lines_updated_byTousers   outbound_shipment_lines[]  @relation("outbound_shipment_lines_updated_byTousers")
  appointment_detail_lines_appointment_detail_lines_created_byTousers appointment_detail_lines[] @relation("appointment_detail_lines_created_byTousers")
  appointment_detail_lines_appointment_detail_lines_updated_byTousers appointment_detail_lines[] @relation("appointment_detail_lines_updated_byTousers")
  outbound_shipments_outbound_shipments_created_byTousers             outbound_shipments[]       @relation("outbound_shipments_created_byTousers")
  outbound_shipments_outbound_shipments_loaded_byTousers              outbound_shipments[]       @relation("outbound_shipments_loaded_byTousers")
  outbound_shipments_outbound_shipments_updated_byTousers             outbound_shipments[]       @relation("outbound_shipments_updated_byTousers")
  wms_labor_logs_wms_labor_logs_created_byTousers                     wms_labor_logs[]           @relation("wms_labor_logs_created_byTousers")
  wms_labor_logs_wms_labor_logs_updated_byTousers                     wms_labor_logs[]           @relation("wms_labor_logs_updated_byTousers")
  wms_labor_logs_wms_labor_logs_user_idTousers                        wms_labor_logs[]           @relation("wms_labor_logs_user_idTousers")
  table_views                                                          table_views[]              @relation("table_views_user_idTousers")

  @@index([department_id], map: "idx_users_department")
  @@schema("public")
}

model vehicles {
  vehicle_id                       BigInt    @id @default(autoincrement())
  carrier_id                       BigInt?
  vehicle_code                     String?   @unique @db.VarChar(50)
  plate_number                     String?   @unique @db.VarChar(50)
  vehicle_type                     String?   @db.VarChar(50)
  vin                              String?   @db.VarChar(100)
  capacity_weight                  Decimal?  @db.Decimal(12, 2)
  capacity_volume                  Decimal?  @db.Decimal(12, 2)
  status                           String?   @default("active") @db.VarChar(50)
  notes                            String?
  created_at                       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                       DateTime? @default(now()) @db.Timestamptz(6)
  created_by                       BigInt?
  updated_by                       BigInt?
  carriers                         carriers? @relation(fields: [carrier_id], references: [carrier_id], onDelete: NoAction, onUpdate: NoAction)
  users_vehicles_created_byTousers users?    @relation("vehicles_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_vehicles_updated_byTousers users?    @relation("vehicles_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

model warehouses {
  warehouse_id                            BigInt               @id @default(autoincrement())
  location_id                             BigInt?
  warehouse_code                          String?              @unique @db.VarChar(50)
  name                                    String               @db.VarChar(200)
  capacity_cbm                            Decimal?             @db.Decimal(12, 2)
  operating_hours                         Json?
  notes                                   String?
  created_at                              DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at                              DateTime?            @default(now()) @db.Timestamptz(6)
  contact_user_id                         BigInt?
  created_by                              BigInt?
  updated_by                              BigInt?
  shift_dim                               shift_dim[]
  users_warehouses_contact_user_idTousers users?               @relation("warehouses_contact_user_idTousers", fields: [contact_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_warehouses_created_byTousers      users?               @relation("warehouses_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations                               locations?           @relation(fields: [location_id], references: [location_id], onDelete: NoAction, onUpdate: NoAction)
  users_warehouses_updated_byTousers      users?               @relation("warehouses_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  inbound_receipt                         inbound_receipt[]
  inventory_lots                          inventory_lots[]
  outbound_shipments                      outbound_shipments[]
  putaway_tasks                           putaway_tasks[]
  wms_labor_logs                          wms_labor_logs[]

  @@schema("public")
}

// 已删除 container_legs 和 containers 模型 - 不再需要，现在使用 pickup_management 和 delivery_management 表

// ============================================
// TMS 重构：新表结构
// ============================================

// 提柜管理（基于 orders，只显示拆柜订单）
model pickup_management {
  pickup_id                                 BigInt    @id @default(autoincrement())
  order_id                                  BigInt    @unique
  earliest_appointment_time                 DateTime? @db.Timestamptz(6)
  status                                    String?   @default("planned") @db.VarChar(50)
  current_location                          String?   @db.VarChar(100)
  port_text                                 String?   @db.VarChar(10)
  shipping_line                             String?   @db.VarChar(10)
  driver_id                                 BigInt?
  notes                                     String?
  created_at                                DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                DateTime? @default(now()) @db.Timestamptz(6)
  created_by                                BigInt?
  updated_by                                BigInt?
  orders                                    orders    @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: Cascade)
  drivers                                   drivers?  @relation(fields: [driver_id], references: [driver_id], onDelete: NoAction, onUpdate: NoAction)
  users_pickup_management_created_byTousers users?    @relation("pickup_management_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_pickup_management_updated_byTousers users?    @relation("pickup_management_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([order_id])
  @@index([status])
  @@index([created_at])
  @@index([earliest_appointment_time])
  @@index([current_location])
  @@index([driver_id])
  @@schema("tms")
}

// 送仓管理（基于 delivery_appointments）
model delivery_management {
  delivery_id                                 BigInt                @id @default(autoincrement())
  appointment_id                              BigInt                @unique
  driver_id                                   BigInt?
  status                                      String?               @default("planned") @db.VarChar(50)
  notes                                       String?
  created_at                                  DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at                                  DateTime?             @default(now()) @db.Timestamptz(6)
  created_by                                  BigInt?
  updated_by                                  BigInt?
  delivery_appointments                       delivery_appointments @relation(fields: [appointment_id], references: [appointment_id], onDelete: Cascade, onUpdate: Cascade)
  drivers                                     drivers?              @relation(fields: [driver_id], references: [driver_id], onDelete: NoAction, onUpdate: NoAction)
  users_delivery_management_created_byTousers users?                @relation("delivery_management_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_delivery_management_updated_byTousers users?                @relation("delivery_management_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([appointment_id])
  @@index([driver_id])
  @@index([status])
  @@index([created_at])
  @@schema("tms")
}

model freight_bills {
  freight_bill_id                       BigInt    @id @default(autoincrement())
  reference_type                        String    @db.VarChar(50)
  reference_id                          BigInt
  carrier_id                            BigInt?
  bill_number                           String?   @unique @db.VarChar(100)
  amount                                Decimal?  @db.Decimal(12, 2)
  currency                              String?   @default("USD") @db.VarChar(10)
  billing_date                          DateTime? @db.Date
  due_date                              DateTime? @db.Date
  status                                String?   @default("pending") @db.VarChar(50)
  notes                                 String?
  created_at                            DateTime? @default(now()) @db.Timestamptz(6)
  created_by                            BigInt?
  updated_at                            DateTime? @default(now()) @db.Timestamptz(6)
  updated_by                            BigInt?
  carriers                              carriers? @relation(fields: [carrier_id], references: [carrier_id], onDelete: NoAction, onUpdate: NoAction)
  users_freight_bills_created_byTousers users?    @relation("freight_bills_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_freight_bills_updated_byTousers users?    @relation("freight_bills_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("tms")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model inbound_receipt {
  inbound_receipt_id                       BigInt           @id @default(autoincrement())
  notes                                    String?
  order_id                                 BigInt           @unique
  unloaded_by                              String?          @db.VarChar
  received_by                              BigInt?
  warehouse_id                             BigInt
  status                                   String           @default("pending") @db.VarChar(50)
  created_at                               DateTime         @default(now()) @db.Timestamptz(6)
  updated_at                               DateTime         @default(now()) @db.Timestamptz(6)
  created_by                               BigInt?
  updated_by                               BigInt?
  planned_unload_at                        DateTime?        @db.Date
  unload_method_code                       String?          @db.VarChar(50)
  delivery_progress                        Decimal?         @db.Decimal(5, 2)
  users_inbound_receipt_created_byTousers  users?           @relation("inbound_receipt_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                                   orders           @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  users_inbound_receipt_received_byTousers users?           @relation("inbound_receipt_received_byTousers", fields: [received_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  unload_methods                           unload_methods?  @relation(fields: [unload_method_code], references: [method_code], onDelete: NoAction, onUpdate: NoAction)
  users_inbound_receipt_updated_byTousers  users?           @relation("inbound_receipt_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses                               warehouses       @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)
  inventory_lots                           inventory_lots[]
  putaway_tasks                            putaway_tasks[]

  @@index([planned_unload_at], map: "idx_inbound_receipt_planned_unload_at")
  @@index([status], map: "idx_inbound_receipt_status")
  @@schema("wms")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model inventory_lots {
  inventory_lot_id                       BigInt           @id @default(autoincrement())
  warehouse_id                           BigInt
  storage_location_code                  String?          @db.VarChar(100)
  status                                 String?          @default("available") @db.VarChar(50)
  notes                                  String?
  order_id                               BigInt
  order_detail_id                        BigInt
  created_at                             DateTime         @default(now()) @db.Timestamptz(6)
  updated_at                             DateTime         @default(now()) @db.Timestamptz(6)
  created_by                             BigInt?
  updated_by                             BigInt?
  inbound_receipt_id                     BigInt?
  lot_number                             String?          @db.VarChar(50)
  received_date                          DateTime?        @db.Date
  pallet_count                           Int              @default(1)
  remaining_pallet_count                 Int?             @default(0)
  unbooked_pallet_count                  Int?             @default(0)
  delivery_progress                      Decimal?         @db.Decimal(5, 2)
  users_inventory_lots_created_byTousers users?           @relation("inventory_lots_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  inbound_receipt                        inbound_receipt? @relation(fields: [inbound_receipt_id], references: [inbound_receipt_id], onDelete: NoAction, onUpdate: NoAction)
  order_detail                           order_detail     @relation(fields: [order_detail_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orders                                 orders           @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  users_inventory_lots_updated_byTousers users?           @relation("inventory_lots_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses                             warehouses       @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([inbound_receipt_id], map: "idx_inventory_lots_inbound_receipt_id")
  @@index([order_detail_id, status], map: "idx_inventory_lots_order_detail_status")
  @@index([status], map: "idx_inventory_lots_status")
  @@schema("wms")
}

model outbound_shipment_lines {
  outbound_shipment_line_id                       BigInt              @id @default(autoincrement())
  outbound_shipment_id                            BigInt?
  notes                                           String?
  order_id                                        BigInt
  order_detail_id                                 BigInt
  created_at                                      DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at                                      DateTime?           @default(now()) @db.Timestamptz(6)
  created_by                                      BigInt?
  updated_by                                      BigInt?
  quantity                                        Int                 @default(1)
  users_outbound_shipment_lines_created_byTousers users?              @relation("outbound_shipment_lines_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_detail                                    order_detail        @relation(fields: [order_detail_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orders                                          orders              @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  outbound_shipments                              outbound_shipments? @relation(fields: [outbound_shipment_id], references: [outbound_shipment_id], onDelete: Cascade, onUpdate: NoAction)
  users_outbound_shipment_lines_updated_byTousers users?              @relation("outbound_shipment_lines_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([outbound_shipment_id, order_detail_id], map: "outbound_shipment_lines_unique")
  @@schema("wms")
}

model outbound_shipments {
  outbound_shipment_id                                                     BigInt                    @id @default(autoincrement())
  warehouse_id                                                             BigInt
  actual_load_time                                                         DateTime?                 @db.Timestamptz(6)
  status                                                                   String?                   @db.VarChar(50)
  total_volume                                                             Decimal?                  @db.Decimal(14, 4)
  total_weight                                                             Decimal?                  @db.Decimal(14, 4)
  notes                                                                    String?
  created_at                                                               DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at                                                               DateTime?                 @default(now()) @db.Timestamptz(6)
  trailer_id                                                               BigInt?
  loaded_by                                                                BigInt?
  created_by                                                               BigInt?
  updated_by                                                               BigInt?
  bol_document_id                                                          BigInt?
  load_sheet_document_id                                                   BigInt?
  appointment_id                                                           BigInt?                   @unique
  outbound_shipment_lines                                                  outbound_shipment_lines[]
  document_links_outbound_shipments_bol_document_idTodocument_links        document_links?           @relation("outbound_shipments_bol_document_idTodocument_links", fields: [bol_document_id], references: [document_id], onDelete: NoAction, onUpdate: NoAction)
  users_outbound_shipments_created_byTousers                               users?                    @relation("outbound_shipments_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  document_links_outbound_shipments_load_sheet_document_idTodocument_links document_links?           @relation("outbound_shipments_load_sheet_document_idTodocument_links", fields: [load_sheet_document_id], references: [document_id], onDelete: NoAction, onUpdate: NoAction)
  users_outbound_shipments_loaded_byTousers                                users?                    @relation("outbound_shipments_loaded_byTousers", fields: [loaded_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  trailers                                                                 trailers?                 @relation(fields: [trailer_id], references: [trailer_id], onDelete: NoAction, onUpdate: NoAction)
  users_outbound_shipments_updated_byTousers                               users?                    @relation("outbound_shipments_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses                                                               warehouses                @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)
  delivery_appointments                                                    delivery_appointments?    @relation(fields: [appointment_id], references: [appointment_id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("wms")
}

model putaway_tasks {
  putaway_task_id           BigInt           @id @default(autoincrement())
  inbound_receipt_detail_id BigInt?
  warehouse_id              BigInt?
  storage_location_code     String?          @db.VarChar(100)
  assigned_to               String?          @db.VarChar(100)
  assigned_at               DateTime?        @db.Timestamptz(6)
  completed_at              DateTime?        @db.Timestamptz(6)
  status                    String?          @default("pending") @db.VarChar(50)
  notes                     String?
  inbound_receipt           inbound_receipt? @relation(fields: [inbound_receipt_detail_id], references: [inbound_receipt_id], onDelete: Cascade, onUpdate: NoAction)
  warehouses                warehouses?      @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("wms")
}

model wms_labor_logs {
  labor_log_id                           BigInt     @id @default(autoincrement())
  warehouse_id                           BigInt
  start_time                             DateTime   @db.Timestamptz(6)
  end_time                               DateTime   @db.Timestamptz(6)
  hours_worked                           Decimal    @db.Decimal(10, 2)
  notes                                  String?
  created_at                             DateTime   @default(now()) @db.Timestamptz(6)
  user_id                                BigInt
  updated_at                             DateTime   @default(now()) @db.Timestamptz(6)
  created_by                             BigInt?
  updated_by                             BigInt?
  users_wms_labor_logs_created_byTousers users?     @relation("wms_labor_logs_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_wms_labor_logs_updated_byTousers users?     @relation("wms_labor_logs_updated_byTousers", fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_wms_labor_logs_user_idTousers    users      @relation("wms_labor_logs_user_idTousers", fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses                             warehouses @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("wms")
}

model inventory_forecast_daily {
  forecast_id          BigInt    @id @default(autoincrement())
  location_id          BigInt?
  location_group       String    @db.VarChar(50)
  location_name        String    @db.VarChar(200)
  forecast_date        DateTime  @db.Date
  historical_inventory Int       @default(0)
  planned_inbound      Int       @default(0)
  planned_outbound     Int       @default(0)
  forecast_inventory   Int       @default(0)
  calculated_at        DateTime? @default(now()) @db.Timestamptz(6)
  calculation_version  Int       @default(1)

  @@unique([location_id, location_group, forecast_date], map: "unique_location_date")
  @@index([location_id, location_group, forecast_date], map: "idx_forecast_location_date")
  @@index([forecast_date], map: "idx_forecast_date")
  @@index([location_group, forecast_date], map: "idx_forecast_location_group")
  @@index([calculated_at], map: "idx_forecast_calculated_at")
  @@schema("analytics")
}

model inventory_forecast_weekly {
  forecast_id          BigInt    @id @default(autoincrement())
  location_id          BigInt?
  location_group       String    @db.VarChar(50)
  location_name        String    @db.VarChar(200)
  week_start_date      DateTime  @db.Date
  week_number          Int       // 第几周（1-8）
  planned_inbound      Int       @default(0) // 本周入库板数（周汇总）
  planned_outbound      Int       @default(0) // 本周出库板数（周汇总）
  remaining_pallets    Int       @default(0) // 未出板数（入库 - 出库）
  calculated_at        DateTime? @default(now()) @db.Timestamptz(6)
  calculation_version  Int       @default(1)

  @@unique([location_id, location_group, week_start_date], map: "unique_location_week")
  @@index([location_id, location_group, week_start_date], map: "idx_forecast_weekly_location_week")
  @@index([week_start_date], map: "idx_forecast_weekly_week_start")
  @@index([location_group, week_start_date], map: "idx_forecast_weekly_location_group")
  @@index([calculated_at], map: "idx_forecast_weekly_calculated_at")
  @@schema("analytics")
}

/// 表格视图配置（用户自定义的表格列显示/宽度/顺序配置）
model table_views {
  id                BigInt   @id @default(autoincrement())
  user_id           BigInt   // 用户ID
  table_name        String   @db.VarChar(100) // 表名，如 "orders", "drivers"
  view_name         String   @db.VarChar(100) // 视图名称，如 "日常管理"
  column_visibility Json     // 列可见性配置 {column_id: boolean}
  column_sizing     Json?    // 列宽配置 {column_id: number}
  column_order      String[] // 列顺序 [column_id, ...]
  is_default        Boolean  @default(false) // 是否为默认视图
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @updatedAt @db.Timestamptz(6)

  // 关联到用户表
  user users @relation("table_views_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade)

  // 联合唯一索引：同一用户同一表的视图名不能重复
  @@unique([user_id, table_name, view_name], map: "unique_user_table_view_name")
  // 索引：加速按用户+表名查询
  @@index([user_id, table_name], map: "idx_table_views_user_table")
  // 索引：加速查找默认视图
  @@index([user_id, table_name, is_default], map: "idx_table_views_default")
  @@schema("public")
}
