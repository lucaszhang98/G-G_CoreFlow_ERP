# 框架分析与批量操作方案

## 📊 当前框架评估

### ✅ 已实现的功能（评分：8/10）

1. **基础CRUD框架** ✅
   - 通用列表、创建、更新、删除
   - 权限控制（基于角色）
   - 表单验证（Zod）

2. **搜索与筛选** ✅
   - 简单搜索（模糊搜索，多字段）
   - 快速筛选（下拉、日期范围、数值范围）
   - 高级搜索（多条件组合，AND/OR逻辑）

3. **表格功能** ✅
   - 服务器端分页
   - 排序（多列）
   - 列可见性控制
   - 操作列（查看详情、删除）

4. **数据展示** ✅
   - 日期格式化（统一框架，不显示年份）
   - 可点击单元格
   - 行内编辑（部分字段）

5. **UI/UX** ✅
   - 现代化设计
   - 响应式布局
   - 加载状态
   - 错误处理

### ❌ 缺失的功能（需要补充）

1. **行选择功能** ❌
   - 没有复选框列
   - 没有全选/反选
   - 没有选中行计数显示

2. **批量操作** ❌
   - 批量编辑
   - 批量删除
   - 批量导出
   - 批量导入
   - 批量状态变更
   - 批量分配

3. **单个编辑** ❌
   - 没有"编辑"按钮（只有查看详情）
   - 行内编辑不完整（只有部分字段支持）

4. **其他专业功能** ❌
   - 操作日志/审计日志
   - 数据导入/导出（Excel）
   - 批量打印
   - 撤销/回滚机制

---

## 🎯 专业ERP系统批量操作方案

### 一、核心批量操作功能

#### 1. **批量编辑** ⭐⭐⭐⭐⭐
**场景**：同时修改多条记录的相同字段
- 批量修改状态（如：批量激活/停用）
- 批量修改分类/标签
- 批量修改价格/数量
- 批量分配（分配给某个用户/部门）

**实现方式**：
- 选择多条记录
- 点击"批量编辑"按钮
- 弹出对话框，显示可批量编辑的字段
- 输入新值，应用到所有选中记录

#### 2. **批量删除** ⭐⭐⭐⭐⭐
**场景**：删除多条不需要的记录
- 批量软删除（如订单归档）
- 批量硬删除（如临时数据）

**实现方式**：
- 选择多条记录
- 点击"批量删除"按钮
- 二次确认对话框（显示选中数量）
- 执行删除，显示结果

#### 3. **批量导出** ⭐⭐⭐⭐
**场景**：导出选中记录为Excel/CSV
- 导出当前页选中记录
- 导出所有筛选结果
- 自定义导出字段

**实现方式**：
- 选择记录（可选）
- 点击"导出"按钮
- 选择导出格式和字段
- 下载文件

#### 4. **批量导入** ⭐⭐⭐⭐
**场景**：从Excel/CSV批量导入数据
- 模板下载
- 数据验证
- 导入预览
- 错误处理

#### 5. **批量状态变更** ⭐⭐⭐⭐
**场景**：批量修改状态字段
- 批量激活/停用
- 批量审核通过/拒绝
- 批量归档

#### 6. **批量分配** ⭐⭐⭐
**场景**：批量分配给某个用户/部门
- 批量分配给负责人
- 批量分配给部门
- 批量分配给仓库

#### 7. **批量打印** ⭐⭐⭐
**场景**：批量打印选中记录
- 打印标签
- 打印报表
- 打印单据

---

### 二、单个编辑操作

#### 1. **行内编辑** ⭐⭐⭐⭐
**当前状态**：部分字段支持（如海柜管理的日期字段）
**改进**：扩展到所有可编辑字段

#### 2. **弹窗编辑** ⭐⭐⭐⭐⭐
**场景**：编辑完整记录
- 点击"编辑"按钮
- 打开编辑对话框（复用创建表单）
- 保存后刷新列表

**专业做法**：
- 编辑按钮放在操作列
- 与"查看详情"区分（查看只读，编辑可修改）
- 支持键盘快捷键（如 F2 编辑）

---

### 三、框架改进建议

#### 优先级 P0（必须实现）

1. **行选择功能**
   - 添加复选框列
   - 全选/反选
   - 选中行计数

2. **批量删除**
   - 最常用，必须实现

3. **单个编辑**
   - 添加"编辑"按钮
   - 复用创建表单

#### 优先级 P1（重要）

4. **批量编辑**
   - 支持常用字段批量修改

5. **批量导出**
   - Excel/CSV导出

#### 优先级 P2（可选）

6. **批量导入**
   - Excel导入功能

7. **批量状态变更**
   - 针对有状态字段的实体

8. **批量分配**
   - 针对有分配字段的实体

---

## 📋 实现方案

### 1. 行选择功能

**前端实现**：
- 在表格第一列添加复选框
- 表头添加全选复选框
- 显示选中数量："已选择 X 条"
- 选中时显示批量操作工具栏

**配置方式**：
```typescript
// EntityConfig 中添加
list: {
  enableRowSelection?: boolean // 是否启用行选择
  selectableRows?: (row: T) => boolean // 哪些行可选
}
```

### 2. 批量操作工具栏

**位置**：选中行后，在表格上方显示工具栏

**按钮**：
- 批量编辑
- 批量删除
- 批量导出
- 其他自定义批量操作

**配置方式**：
```typescript
// EntityConfig 中添加
list: {
  batchOperations?: {
    edit?: {
      enabled: boolean
      fields: string[] // 可批量编辑的字段
    }
    delete?: {
      enabled: boolean
    }
    export?: {
      enabled: boolean
      formats: ['excel', 'csv']
    }
    // 自定义批量操作
    custom?: Array<{
      label: string
      icon?: React.ReactNode
      onClick: (selectedRows: T[]) => void
    }>
  }
}
```

### 3. 批量操作API

**批量删除**：
```
POST /api/{entity}/batch-delete
Body: { ids: string[] }
```

**批量编辑**：
```
POST /api/{entity}/batch-update
Body: { 
  ids: string[]
  updates: { field: value } // 要修改的字段
}
```

**批量导出**：
```
POST /api/{entity}/batch-export
Body: { 
  ids?: string[] // 可选，不传则导出所有筛选结果
  fields: string[] // 要导出的字段
  format: 'excel' | 'csv'
}
```

---

## 🎨 UI/UX 设计建议

### 1. 行选择UI
- 复选框列宽度：48px
- 选中行高亮显示（浅蓝色背景）
- 表头全选复选框：支持"全选当前页"和"全选所有"

### 2. 批量操作工具栏
- 位置：表格上方，选中行后显示
- 样式：固定在表格顶部，带阴影
- 显示：已选择 X 条，操作按钮组

### 3. 批量编辑对话框
- 显示选中记录数量
- 只显示可批量编辑的字段
- 字段说明：修改后将应用到所有选中记录
- 预览：显示前3条记录的关键信息

### 4. 批量删除确认
- 显示选中数量
- 显示前3条记录的关键信息
- 警告提示：此操作不可撤销
- 二次确认：输入"确认"或"DELETE"

---

## 📝 当前框架评分

### 总体评分：**7.5/10**

**优点**：
- ✅ 框架设计合理，可扩展性强
- ✅ 搜索筛选功能完善
- ✅ UI/UX 现代化
- ✅ 代码结构清晰

**缺点**：
- ❌ 缺少行选择功能
- ❌ 缺少批量操作
- ❌ 缺少单个编辑功能
- ❌ 缺少导入/导出功能
- ❌ 缺少操作日志

**改进后预期评分**：**9.5/10**

---

## 🚀 实施建议

### 第一阶段（核心功能）
1. 实现行选择功能
2. 实现批量删除
3. 实现单个编辑

### 第二阶段（重要功能）
4. 实现批量编辑
5. 实现批量导出

### 第三阶段（增强功能）
6. 实现批量导入
7. 实现批量状态变更
8. 实现操作日志

---

## 💡 专业ERP系统最佳实践

1. **权限控制**：所有批量操作都需要权限验证
2. **操作确认**：危险操作（如删除）需要二次确认
3. **操作日志**：记录所有批量操作，包括操作人、时间、影响记录数
4. **性能优化**：批量操作使用事务，失败时回滚
5. **用户体验**：显示操作进度，支持取消
6. **数据验证**：批量编辑前验证数据有效性
7. **撤销机制**：支持撤销最近一次批量操作（可选）

